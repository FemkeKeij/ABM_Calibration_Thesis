---
title: "WolfSheep_01_Explore_Model"
author: "Femke Keij S2647168"
date: "2023-03-15"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Clear working directory:
```{r}
rm(list = ls(all = TRUE)) 
```

Packages used:
```{r}
# for importing / working with tidy data
library(tidyverse)

# for arranging ggplots
library(patchwork)

# for ggplot aesthetics
library(directlabels)
library(RColorBrewer)
```

Random seed:
```{r}
set.seed(42)
```

Read in the data:
```{r}
# complete data set
ws_output <- read_csv(
  'data/raw/wolfsheep_output.csv')

# training data
ws_train <- read_csv(
  'data/processed/wolfsheep_train.csv')

# test data
ws_test <- read_csv(
  'data/processed/wolfsheep_test.csv')

# output data summary
ws_summary <- read_csv(
  'data/processed/wolfsheep_summary.csv')

# parameter combinations
all_comb <- read_csv('data/processed/wolfsheep_parameterspace.csv')
```

# Plots / looking for equifinality
Initial sheep and wolves plus the resulting final average numbers of sheep and wolves
```{r}
ws_summary_lasttick <- ws_summary %>%
  group_by(combination_number) %>%
  mutate(max_ticks = max(ticks)) %>%
  filter(ticks == max_ticks) %>%
  ungroup()

p1 <- ws_summary_lasttick %>%
  ggplot(mapping = aes(x = initial_number_sheep, y = initial_number_wolves)) +
  geom_point(mapping = aes(colour = mean_sheep),
             size = 5) +
  theme_minimal()+
  theme(panel.grid.minor = element_blank()) +
  labs(x = 'initial number of sheep',
       y = 'initial number of wolves',
       colour = 'mean number of \n sheep at last tick') +
  scale_colour_gradient(low = 'navy', high = 'red')

p2 <- ws_summary_lasttick %>%
  ggplot(mapping = aes(x = initial_number_sheep, y = initial_number_wolves)) +
  geom_point(mapping = aes(colour = mean_wolves),
             size = 5) +
  theme_minimal()+
  theme(panel.grid.minor = element_blank()) +
  labs(x = 'initial number of sheep',
       y = 'initial number of wolves',
       colour = 'mean number of \n wolves at last tick') +
  scale_colour_gradient(low = 'navy', high = 'red')

p1 + p2
```

Visualise all time series:
```{r}
p_sheep <- ws_summary %>%
  ggplot(mapping = aes(x = ticks, y = mean_sheep,
                       group = combination_number)) +
  geom_line(colour = 'bisque2') +
  theme_minimal() +
  labs(y = 'sheep')

p_wolves <- ws_summary %>%
  ggplot(mapping = aes(x = ticks, y = mean_wolves,
                       group = combination_number)) +
  geom_line(colour = 'darkgrey') +
  theme_minimal() +
  labs(y = 'wolves')

p_grass <- ws_summary %>%
  ggplot(mapping = aes(x = ticks, y = mean_grass,
                       group = combination_number)) +
  geom_line(colour = 'darkgreen') +
  theme_minimal() +
  labs(y = 'grass')

p_sheep + p_wolves + p_grass
```

Now do the same, but color each based on the values of the 7 parameters:
```{r}
ws_summary_cat <- ws_summary %>%
  mutate(sheep_cat = cut(initial_number_sheep,
                         breaks = c(-Inf, 50, 100, 150, 200, Inf),
                         labels = c('0 - 50', '51 - 100', '101 - 150',
                                    '151 - 200', '201 - 250')),
         wolves_cat = cut(initial_number_wolves,
                          breaks = c(-Inf, 50, 100, 150, 200, Inf),
                          labels = c('0 - 50', '51 - 100', '101 - 150',
                                    '151 - 200', '201 - 250')),
         sheep_food_cat = cut(sheep_gain_from_food,
                         breaks = c(-Inf, 25, Inf),
                         labels = c('0 - 25', '26 - 50')),
         wolves_food_cat = cut(wolves_gain_from_food,
                         breaks = c(-Inf, 25, 50, 75, Inf),
                         labels = c('0 - 25', '26 - 50', '51 - 75', '76 - 100')),
         sheep_rep_cat = cut(sheep_reproduce,
                         breaks = c(-Inf, 10, Inf),
                         labels = c('0 - 10', '11 - 20')),
         wolves_rep_cat = cut(wolves_reproduce,
                         breaks = c(-Inf, 10, Inf),
                         labels = c('1 - 10', '11 - 20')),
         grass_cat = cut(grass_regrowth,
                         breaks = c(-Inf, 25, 50, 75, Inf),
                         labels = c('0 - 25', '26 - 50', '51 - 75', '76 - 100')))
```

Function for plots
```{r}
PlotParameterSpace <- function(parameter, label){
  p_sheep <- ws_summary_cat %>%
    ggplot(mapping = aes(x = ticks, y = mean_sheep,
                       group = combination_number, colour = get(parameter))) +
    geom_line() +
    theme_minimal() +
    labs(y = 'sheep',
         colour = label)

  p_wolves <- ws_summary_cat %>%
    ggplot(mapping = aes(x = ticks, y = mean_wolves,
                       group = combination_number, colour = get(parameter))) +
    geom_line() +
    theme_minimal() +
    labs(y = 'wolves',
         colour = label)

  p_grass <- ws_summary_cat %>%
    ggplot(mapping = aes(x = ticks, y = mean_grass,
                       group = combination_number, colour = get(parameter))) +
    geom_line() +
    theme_minimal() +
    labs(y = 'grass',
         colour = label)
  
  plot <- p_sheep + p_wolves + p_grass + plot_layout(guides = 'collect')
  
  return(plot)
}
```

1) initial_number_sheep
```{r}
PlotParameterSpace(parameter = 'sheep_cat',
                   label = 'initial number of sheep')
```

2) initial_number_wolves
```{r}
PlotParameterSpace(parameter = 'wolves_cat',
                   label = 'initial numbr of wolves')
```

3) sheep_gain_from_food
```{r}
PlotParameterSpace(parameter = 'sheep_food_cat',
                   label = 'sheep gain from food')
```

4) wolves_gain_from_food
```{r}
PlotParameterSpace(parameter = 'wolves_food_cat',
                   label = 'wolves gain from food')
```

5) sheep_reproduce
```{r}
PlotParameterSpace(parameter = 'sheep_rep_cat',
                   label = 'probability sheep reproduce')
```

6) wolves_reproduce
```{r}
PlotParameterSpace(parameter = 'wolves_rep_cat',
                   label = 'probability wolves reproduce')
```

7) grass_regrowth_time
```{r}
PlotParameterSpace(parameter = 'grass_cat',
                   label = 'grass regrowth time')
```

It seems very difficult to say anything about equifinality here, since there are so many different parameters to look at at once.

# Identifying unidentifiable parameters
Correlogram of all variables and outputs:
```{r}

```

