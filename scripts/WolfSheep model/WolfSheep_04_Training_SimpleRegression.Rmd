---
title: "WolfSheep_04_Training_SimpleRegression"
author: "Femke Keij S2647168"
date: "2023-07-12"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Clear working directory & set random seed:
```{r}
rm(list = ls(all = TRUE))

set.seed(42)
```

Packages used:
```{r}
# for importing / working with tidy data
library(tidyverse)

# for ggplot
library(directlabels)
library(patchwork)
library(ggbeeswarm)

# for creating the cross-validation folds
library(caret)
```

Functions used:
```{r}
source('scripts/WolfSheep/WolfSheep_Functions.R')
```

Read in the data:
```{r}
# training data
ws_train <- read_csv('data/training/wolfsheep_training.csv') %>%
  rename(trend_grass_noise = tend_grass_noise)
```

# Fitting with cross-validation
We fit a separate regression for each input parameter. All output variables serve as predictors. We apply a 5-fold cross-validation, and obtain the error computations for each one. The errors are then averaged across the 5 folds.

Function to cross-validate linear regression
```{r}
WolfSheepSimpleRegressionFitting <- function(data_clean,
                                             data_outputnoise,
                                             data_doublenoise){
  # data_clean: the data frame containing the input parameters as well as the relevant outputs
  # data_outputnoise: the data frame containing the input parameters as well as the relevant outputs, with output noise
  # data_doublenoise: the data frame containing the input parameters as well as the relevant outputs, with output and temporal noise
  
  # create the folds
  flds <- createFolds(1:nrow(data_clean),
                      k = 5, list = TRUE, returnTrain = FALSE)

  # to store the results
  results_df <- tibble(fold = numeric(),
                       noise = character(),
                       initial_number_sheep = numeric(),
                       initial_number_sheep_pred = numeric(),
                       initial_number_wolves = numeric(),
                       initial_number_wolves_pred = numeric(),
                       sheep_gain_from_food = numeric(),
                       sheep_gain_from_food_pred = numeric(),
                       wolves_gain_from_food = numeric(),
                       wolves_gain_from_food_pred = numeric(),
                       sheep_reproduce = numeric(),
                       sheep_reproduce_pred = numeric(),
                       wolves_reproduce = numeric(),
                       wolves_reproduce_pred = numeric(),
                       grass_regrowth = numeric(),
                       grass_regrowth_pred = numeric())
  
  # for each cross-validation fold
  for(i in 1:5){
    # remove the test fold to create the training data
    dat_train <- data_clean %>%
      filter(!row_number() %in% unlist(flds[i]))
  
    # obtain the test fold without noise
    dat_test <- data_clean %>%
      filter(row_number() %in% unlist(flds[i]))
    # obtain the test fold with output noise
    dat_test_outputnoise <- data_outputnoise %>%
      filter(row_number() %in% unlist(flds[i]))
    # obtain the test fold with output and temporal noise
    if(!any(is.na(data_doublenoise))){
    dat_test_doublenoise <- data_doublenoise %>%
      filter(row_number() %in% unlist(flds[i]))
    }
    
    # train the linear regressions
    initial_sheep_lr <- lm(formula = initial_number_sheep ~ . 
                           - initial_number_wolves 
                           - sheep_gain_from_food 
                           - wolves_gain_from_food 
                           - sheep_reproduce 
                           - wolves_reproduce 
                           - grass_regrowth,
                           data = dat_train)
    initial_wolves_lr <- lm(formula = initial_number_wolves ~ . 
                           - initial_number_sheep 
                           - sheep_gain_from_food 
                           - wolves_gain_from_food 
                           - sheep_reproduce 
                           - wolves_reproduce 
                           - grass_regrowth,
                           data = dat_train)
    food_sheep_lr <- lm(formula = sheep_gain_from_food ~ . 
                          - initial_number_sheep
                          - initial_number_wolves
                           - wolves_gain_from_food 
                           - sheep_reproduce 
                           - wolves_reproduce 
                           - grass_regrowth,
                           data = dat_train)
    food_wolves_lr <- lm(formula = wolves_gain_from_food ~ . 
                           - initial_number_wolves
                           - initial_number_sheep
                           - sheep_gain_from_food
                           - sheep_reproduce 
                           - wolves_reproduce 
                           - grass_regrowth,
                           data = dat_train)
    rep_sheep_lr <- lm(formula = sheep_reproduce ~ . 
                           - initial_number_wolves
                           - initial_number_sheep
                           - sheep_gain_from_food 
                           - wolves_gain_from_food
                           - wolves_reproduce 
                           - grass_regrowth,
                           data = dat_train)
    rep_wolves_lr <- lm(formula = wolves_reproduce ~ . 
                           - initial_number_wolves
                           - initial_number_sheep
                           - sheep_gain_from_food 
                           - wolves_gain_from_food 
                           - sheep_reproduce
                           - grass_regrowth,
                           data = dat_train)
    grass_lr <- lm(formula = grass_regrowth ~ . 
                           - initial_number_wolves
                           - initial_number_sheep
                           - sheep_gain_from_food 
                           - wolves_gain_from_food 
                           - sheep_reproduce 
                           - wolves_reproduce,
                           data = dat_train)
   
    # create predictions data frame
    # without noise
    results_df <- results_df %>%
      add_row(fold = i,
              noise = 'clean',
              initial_number_sheep = dat_test$initial_number_sheep,
              initial_number_sheep_pred = 
                predict(initial_sheep_lr, newdata = dat_test),
              initial_number_wolves = dat_test$initial_number_wolves,
              initial_number_wolves_pred = 
                predict(initial_wolves_lr, newdata = dat_test),
              sheep_gain_from_food = dat_test$sheep_gain_from_food,
              sheep_gain_from_food_pred = 
                predict(food_sheep_lr, newdata = dat_test),
              wolves_gain_from_food = dat_test$wolves_gain_from_food,
              wolves_gain_from_food_pred = 
                predict(food_wolves_lr, newdata = dat_test),
              sheep_reproduce = dat_test$sheep_reproduce,
              sheep_reproduce_pred = 
                predict(rep_sheep_lr, newdata = dat_test),
              wolves_reproduce = dat_test$wolves_reproduce,
              wolves_reproduce_pred = 
                predict(rep_wolves_lr, newdata = dat_test),
              grass_regrowth = dat_test$grass_regrowth,
              grass_regrowth_pred = 
                predict(grass_lr, newdata = dat_test))
    # with output noise
    results_df <- results_df %>%
      add_row(fold = i,
              noise = 'output noise',
              initial_number_sheep = dat_test$initial_number_sheep,
              initial_number_sheep_pred = 
                predict(initial_sheep_lr,
                        newdata = dat_test_outputnoise),
              initial_number_wolves = dat_test$initial_number_wolves,
              initial_number_wolves_pred = 
                predict(initial_wolves_lr,
                        newdata = dat_test_outputnoise),
              sheep_gain_from_food = dat_test$sheep_gain_from_food,
              sheep_gain_from_food_pred = 
                predict(food_sheep_lr, newdata = dat_test_outputnoise),
              wolves_gain_from_food = dat_test$wolves_gain_from_food,
              wolves_gain_from_food_pred = 
                predict(food_wolves_lr,
                        newdata = dat_test_outputnoise),
              sheep_reproduce = dat_test$sheep_reproduce,
              sheep_reproduce_pred = 
                predict(rep_sheep_lr, newdata = dat_test_outputnoise),
              wolves_reproduce = dat_test$wolves_reproduce,
              wolves_reproduce_pred = 
                predict(rep_wolves_lr, newdata = dat_test_outputnoise),
              grass_regrowth = dat_test$grass_regrowth,
              grass_regrowth_pred = 
                predict(grass_lr, newdata = dat_test_outputnoise))
    
    # predict the left-out fold with output and temporal noise
    if(!any(is.na(data_doublenoise))){
      results_df <- results_df %>%
        add_row(fold = i,
              noise = 'double noise',
              initial_number_sheep = dat_test$initial_number_sheep,
              initial_number_sheep_pred = 
                predict(initial_sheep_lr,
                        newdata = dat_test_doublenoise),
              initial_number_wolves = dat_test$initial_number_wolves,
              initial_number_wolves_pred = 
                predict(initial_wolves_lr,
                        newdata = dat_test_doublenoise),
              sheep_gain_from_food = dat_test$sheep_gain_from_food,
              sheep_gain_from_food_pred = 
                predict(food_sheep_lr, newdata = dat_test_doublenoise),
              wolves_gain_from_food = dat_test$wolves_gain_from_food,
              wolves_gain_from_food_pred = 
                predict(food_wolves_lr,
                        newdata = dat_test_doublenoise),
              sheep_reproduce = dat_test$sheep_reproduce,
              sheep_reproduce_pred = 
                predict(rep_sheep_lr, newdata = dat_test_doublenoise),
              wolves_reproduce = dat_test$wolves_reproduce,
              wolves_reproduce_pred = 
                predict(rep_wolves_lr, newdata = dat_test_doublenoise),
              grass_regrowth = dat_test$grass_regrowth,
              grass_regrowth_pred = 
                predict(grass_lr, newdata = dat_test_doublenoise))
    }
  }
  return(results_df)
}
```

Error computations:
```{r}
WSComputeErrors <- function(predictions,
                            sample_size, sample_method,
                            summarise_runs, datapoints,
                            double_noise = TRUE){
  # predictions: dataframe with results from fitting
  # sample_size, sample_method, summarise_runs, datapoints: info to
  #     pass on to output data frame
  # double_noise: indicates whether the dataframe includes temporal
  #     noise as well as output noise
  
  # to store the results:
  errors <- tibble(perc_correct_params = numeric(),
                   perc_initial_sheep_correct = numeric(),
                   perc_initial_wolves_correct = numeric(),
                   perc_food_sheep_correct = numeric(),
                   perc_food_wolves_correct = numeric(),
                   perc_sheep_rep_correct = numeric(),
                   perc_wolves_rep_correct = numeric(),
                   perc_grass_correct = numeric(),
                   RMSE_initial_sheep = numeric(),
                   RMSE_initial_wolves = numeric(),
                   RMSE_food_sheep = numeric(),
                   RMSE_food_wolves = numeric(),
                   RMSE_sheep_rep = numeric(),
                   RMSE_wolves_rep = numeric(),
                   RMSE_grass = numeric(),
                   NRMSE_initial_sheep = numeric(),
                   NRMSE_initial_wolves = numeric(),
                   NRMSE_food_sheep = numeric(),
                   NRMSE_food_wolves = numeric(),
                   NRMSE_sheep_rep = numeric(),
                   NRMSE_wolves_rep = numeric(),
                   NRMSE_grass = numeric(),
                   ppp_initial_sheep = numeric(),
                   ppp_initial_wolves = numeric(),
                   ppp_food_sheep = numeric(),
                   ppp_food_wolves = numeric(),
                   ppp_sheep_rep = numeric(),
                   ppp_wolves_rep = numeric(),
                   ppp_grass = numeric(),
                   fold = numeric(),
                   noise = character())
  
  # for each noise level
  if(double_noise){
    noise_levels <- c('clean', 'output noise', 'double noise')
  } else {
    noise_levels <- c('clean', 'output noise')
  }
  
  for(i in noise_levels){
    data_noise <- predictions %>%
      filter(noise == i)
    for(j in 1:5){
      # compute mean values in training data
      mean_vals <- data_noise %>%
        filter(fold != j) %>%
        summarise(mean_initial_number_sheep =
                    mean(initial_number_sheep),
                  mean_initial_number_wolves = 
                    mean(initial_number_wolves),
                  mean_sheep_gain_from_food = 
                    mean(sheep_gain_from_food),
                  mean_wolves_gain_from_food = 
                    mean(wolves_gain_from_food),
                  mean_sheep_reproduce = mean(sheep_reproduce),
                  mean_wolves_reproduce = mean(wolves_reproduce),
                  mean_grass_regrowth = mean(grass_regrowth))
      
      data <- data_noise %>%
        filter(fold == j)
      
      new_errors <- data %>%
        summarise(perc_correct_params =
                      sum(initial_number_sheep_pred ==
                            initial_number_sheep &
                            initial_number_wolves_pred ==
                            initial_number_wolves & 
                            sheep_gain_from_food_pred ==
                            sheep_gain_from_food &
                            wolves_gain_from_food_pred ==
                            wolves_gain_from_food &
                            sheep_reproduce_pred ==
                            sheep_reproduce &
                            wolves_reproduce_pred == 
                            wolves_reproduce & 
                            grass_regrowth_pred ==
                            grass_regrowth) / nrow(data) * 100,
                   perc_initial_sheep_correct =
                     sum(initial_number_sheep ==
                           initial_number_sheep_pred) /
                     nrow(data) * 100,
                   perc_initial_wolves_correct =
                     sum(initial_number_wolves ==
                           initial_number_wolves_pred) /
                     nrow(data) * 100,
                   perc_food_sheep_correct =
                     sum(sheep_gain_from_food ==
                           sheep_gain_from_food_pred) /
                     nrow(data) * 100,
                   perc_food_wolves_correct =
                     sum(wolves_gain_from_food ==
                           wolves_gain_from_food_pred) /
                     nrow(data) * 100,
                   perc_sheep_rep_correct =
                     sum(sheep_reproduce == sheep_reproduce_pred) /
                     nrow(data) * 100,
                   perc_wolves_rep_correct =
                     sum(wolves_reproduce == wolves_reproduce_pred) /
                     nrow(data) * 100,
                   perc_grass_correct =
                     sum(grass_regrowth == grass_regrowth_pred) /
                     nrow(data) * 100,
                   RMSE_initial_sheep =
                     sqrt(sum((initial_number_sheep_pred -
                                 initial_number_sheep)^2)) /
                     nrow(data),
                   RMSE_initial_wolves =
                     sqrt(sum((initial_number_wolves_pred -
                                 initial_number_wolves)^2)) /
                     nrow(data),
                   RMSE_food_sheep =
                     sqrt(sum((sheep_gain_from_food_pred -
                                 sheep_gain_from_food)^2)) /
                     nrow(data),
                   RMSE_food_wolves =
                     sqrt(sum((wolves_gain_from_food_pred -
                                 wolves_gain_from_food)^2)) /
                     nrow(data),
                   RMSE_sheep_rep =
                     sqrt(sum((sheep_reproduce_pred -
                                 sheep_reproduce)^2)) / nrow(data),
                   RMSE_wolves_rep =
                     sqrt(sum((wolves_reproduce_pred -
                                 wolves_reproduce)^2)) / nrow(data),
                   RMSE_grass =
                     sqrt(sum((grass_regrowth_pred -
                                 grass_regrowth)^2)) / nrow(data),
                   NRMSE_initial_sheep =
                     (sqrt(sum((initial_number_sheep_pred -
                                  initial_number_sheep)^2)) /
                        nrow(data)) / sd(initial_number_sheep),
                   NRMSE_initial_wolves =
                     (sqrt(sum((initial_number_wolves_pred -
                                  initial_number_wolves)^2)) /
                        nrow(data)) / sd(initial_number_wolves),
                   NRMSE_food_sheep =
                     (sqrt(sum((sheep_gain_from_food_pred -
                                  sheep_gain_from_food)^2)) /
                        nrow(data)) / sd(sheep_gain_from_food),
                   NRMSE_food_wolves =
                     (sqrt(sum((wolves_gain_from_food_pred -
                                  wolves_gain_from_food)^2)) /
                        nrow(data)) / sd(wolves_gain_from_food),
                   NRMSE_sheep_rep =
                     (sqrt(sum((sheep_reproduce_pred -
                                  sheep_reproduce)^2)) / nrow(data)) /
                     sd(sheep_reproduce),
                   NRMSE_wolves_rep =
                     (sqrt(sum((wolves_reproduce_pred -
                                  wolves_reproduce)^2)) /
                        nrow(data)) / sd(wolves_reproduce),
                   NRMSE_grass =
                     (sqrt(sum((grass_regrowth_pred -
                                  grass_regrowth)^2)) /
                        nrow(data)) / sd(grass_regrowth),
                   ppp_initial_sheep =
                     1 - sum(sqrt((initial_number_sheep_pred -
                                     initial_number_sheep)^2)) /
                     sum(sqrt((initial_number_sheep  - 
                            mean_vals$mean_initial_number_sheep)^2)),
                   ppp_initial_wolves =
                     1 - sum(sqrt((initial_number_wolves_pred -
                                     initial_number_wolves)^2)) /
                      sum(sqrt((initial_number_wolves -
                          mean_vals$mean_initial_number_wolves)^2)),
                   ppp_food_sheep =
                     1 - sum(sqrt((sheep_gain_from_food_pred -
                                     sheep_gain_from_food)^2)) /
                     sum(sqrt((sheep_gain_from_food -
                             mean_vals$mean_sheep_gain_from_food)^2)),
                   ppp_food_wolves =
                     1 - sum(sqrt((wolves_gain_from_food_pred -
                                     wolves_gain_from_food)^2)) /
                     sum(sqrt((wolves_gain_from_food -
                            mean_vals$mean_wolves_gain_from_food)^2)),
                   ppp_sheep_rep =
                     1 - sum(sqrt((sheep_reproduce_pred -
                                     sheep_reproduce)^2)) /
                        sum(sqrt((sheep_reproduce -
                                  mean_vals$mean_sheep_reproduce)^2)),
                   ppp_wolves_rep =
                     1 - sum(sqrt((wolves_reproduce_pred -
                                     wolves_reproduce)^2)) /
                     sum(sqrt((wolves_reproduce -
                                 mean_vals$mean_wolves_reproduce)^2)),
                   ppp_grass =
                     1 - sum(sqrt((grass_regrowth_pred -
                                     grass_regrowth)^2)) /
                     sum(sqrt((grass_regrowth -
                                 mean_vals$mean_grass_regrowth)^2)),
                   fold = j,
                   noise = i)
          
          errors <- errors %>%
            add_row(new_errors)
        }
  }
  # compute mean over folds (per noise type)
  errors <- errors %>%
    group_by(noise) %>%
    summarise_all(mean) %>%
    select(- fold) %>%
    # add the experiment info to the df
    add_column(sample_size = sample_size,
               sample_method = sample_method,
               summarise_runs = summarise_runs,
               datapoints = datapoints)
    
  return(errors)  
}
```

Now fit regressions for all data combinations:
- endpoints only, full time series, timesteps every 10, 20, or 50 ticks
- runs summarised or not
- data without noise, data with output noise, data with output and temporal noise
- random vs. LHS sampling
- 1250, 5000, vs. 10000 samples

Endpoints only:
```{r}
# not summarised
# read in relevant data
data_end_full_clean <- read_csv('data/training/ws_end_full_clean.csv')
data_end_full_outputnoise <-
  read_csv('data/training/ws_end_full_outputnoise.csv')

# no temporal noise here because it's endpoints only

# fit regression
fit_end_full <- WolfSheepSimpleRegressionFitting(
  data_clean = data_end_full_clean,
  data_outputnoise = data_end_full_outputnoise,
  data_doublenoise = NA)

# compute errors
errors_df <- WSComputeErrors(predictions = fit_end_full,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'full',
                             datapoints = 'endpoints',
                             double_noise = FALSE)

# summarised
data_end_sum_clean <- read_csv('data/training/ws_end_sum_clean.csv')
data_end_sum_outputnoise <-
  read_csv('data/training/ws_end_sum_outputnoise.csv')

fit_end_sum <- WolfSheepSimpleRegressionFitting(
  data_clean = data_end_sum_clean,
  data_outputnoise = data_end_sum_outputnoise,
  data_doublenoise = NA)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_end_sum,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'summarised',
                             datapoints = 'endpoints',
                            double_noise = FALSE))
```

Timesteps every 10 ticks
```{r}
# not summarised
data_10_full_clean <- 
  read_csv('data/training/ws_10_full_clean.csv')
data_10_full_outputnoise <- 
  read_csv('data/training/ws_10_full_outputnoise.csv')
data_10_full_doublenoise <- 
  read_csv('data/training/ws_10_full_doublenoise.csv')

fit_10_full <- WolfSheepSimpleRegressionFitting(
  data_clean = data_10_full_clean,
  data_outputnoise = data_10_full_outputnoise,
  data_doublenoise = data_10_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_10_full,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'full',
                             datapoints = 'timesteps 10'))

# summarised
data_10_sum_clean <- 
  read_csv('data/training/ws_10_sum_clean.csv')
data_10_sum_outputnoise <- 
  read_csv('data/training/ws_10_sum_outputnoise.csv')
data_10_sum_doublenoise <- 
  read_csv('data/training/ws_10_sum_doublenoise.csv')

fit_10_sum <- WolfSheepSimpleRegressionFitting(
  data_clean = data_10_sum_clean,
  data_outputnoise = data_10_sum_outputnoise,
  data_doublenoise = data_10_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_10_sum,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'summarised',
                             datapoints = 'timesteps 10'))
```

Timesteps every 20 ticks
```{r}
# not summarised
data_20_full_clean <-
  read_csv('data/training/ws_20_full_clean.csv')
data_20_full_outputnoise <- 
  read_csv('data/training/ws_20_full_outputnoise.csv')
data_20_full_doublenoise <- 
  read_csv('data/training/ws_20_full_doublenoise.csv')
  
fit_20_full <- WolfSheepSimpleRegressionFitting(
  data_clean = data_20_full_clean,
  data_outputnoise = data_20_full_outputnoise,
  data_doublenoise = data_20_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_20_full,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'full',
                             datapoints = 'timesteps 20'))

# summarised
data_20_sum_clean <- 
  read_csv('data/training/ws_20_sum_clean.csv')
data_20_sum_outputnoise <- 
  read_csv('data/training/ws_20_sum_outputnoise.csv')
data_20_sum_doublenoise <- 
  read_csv('data/training/ws_20_sum_doublenoise.csv')

fit_20_sum <- WolfSheepSimpleRegressionFitting(
  data_clean = data_20_sum_clean,
  data_outputnoise = data_20_sum_outputnoise,
  data_doublenoise = data_20_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_20_sum,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'summarised',
                             datapoints = 'timesteps 20'))
```

Timesteps every 50 ticks
```{r}
# not summarised
data_50_full_clean <- 
  read_csv('data/training/ws_50_full_clean.csv')
data_50_full_outputnoise <- 
  read_csv('data/training/ws_50_full_outputnoise.csv')
data_50_full_doublenoise <- 
  read_csv('data/training/ws_50_full_doublenoise.csv')

fit_50_full <- WolfSheepSimpleRegressionFitting(
  data_clean = data_50_full_clean,
  data_outputnoise = data_50_full_outputnoise,
  data_doublenoise = data_50_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_50_full,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'full',
                             datapoints = 'timesteps 50'))

# summarised
data_50_sum_clean <- 
  read_csv('data/training/ws_50_sum_clean.csv')
data_50_sum_outputnoise <- 
  read_csv('data/training/ws_50_sum_outputnoise.csv')
data_50_sum_doublenoise <- 
  read_csv('data/training/ws_50_sum_doublenoise.csv')

fit_50_sum <- WolfSheepSimpleRegressionFitting(
  data_clean = data_50_sum_clean,
  data_outputnoise = data_50_sum_outputnoise,
  data_doublenoise = data_50_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_50_sum,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'summarised',
                             datapoints = 'timesteps 50'))
```

Full time series
```{r,  eval = FALSE}
# not summarised
data_series_full_clean <- 
  read_csv('data/training/ws_series_full_clean.csv')
data_series_full_outputnoise <- 
  read_csv('data/training/ws_series_full_outputnoise.csv')
data_series_full_doublenoise <- 
  read_csv('data/training/ws_series_full_doublenoise.csv')

fit_series_full <- WolfSheepSimpleRegressionFitting(
  data_clean = data_series_full_clean,
  data_outputnoise = data_series_full_outputnoise,
  data_doublenoise = data_series_full_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_series_full,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'full',
                             datapoints = 'timeseries'))

# summarised
data_series_sum_clean <- 
  read_csv('data/training/ws_series_sum_clean.csv')
data_series_sum_outputnoise <- 
  read_csv('data/training/ws_series_sum_outputnoise.csv')
data_series_sum_doublenoise <- 
  read_csv('data/training/ws_series_sum_doublenoise.csv')

fit_series_sum <- WolfSheepSimpleRegressionFitting(
  data_clean = data_series_sum_clean,
  data_outputnoise = data_series_sum_outputnoise,
  data_doublenoise = data_series_sum_doublenoise)

errors_df <- errors_df %>%
  add_row(WSComputeErrors(predictions = fit_series_sum,
                             sample_size = 40,
                             sample_method = 'trial',
                             summarise_runs = 'summarised',
                             datapoints = 'timeseries'))
```

Save data:
```{r}
# check what I need to call this
errors_df %>%
  write_csv('data/results/wolfsheep_LR_errors.csv')

# save fitted values also? (this would just be for plotting, of which I'm not so sure yet that I want to do that)
```

########## ------------ OLD CODE ------------------- #############

# Visualise results
Split into sheep, wolves, grass:
```{r}
errors_long <- errors_df %>%
  pivot_longer(cols = - c(noise, sample_size, sample_method,
                          summarise_runs, datapoints),
               names_to = 'metric',
               values_to = 'value') %>%
  rowwise %>%
  mutate(metric_general = str_split(metric, '_', 2)[[1]][1],
         entity = str_split(metric, '_', 2)[[1]][2]) %>%
  select(- metric) %>%
  rename(metric = metric_general) %>%
  mutate(entity = ifelse(entity == 'initial_sheep_correct',
                     'initial_sheep', entity),
         entity = ifelse(entity == 'initial_wolves_correct',
                         'initial_wolves', entity),
         entity = ifelse(entity == 'food_sheep_correct',
                         'food_sheep', entity),
         entity = ifelse(entity == 'food_wolves_correct',
                         'food_wolves', entity),
         entity = ifelse(entity == 'sheep_rep_correct',
                         'sheep_rep', entity),
         entity = ifelse(entity == 'wolves_rep_correct',
                         'wolves_rep', entity),
         entity = ifelse(entity == 'grass_correct',
                         'grass', entity),
         entity = ifelse(entity == 'correct_params',
                         'all parameters', entity))

# for the full data
plot_errors_long_full_RMSE <- errors_long %>%
  filter(summarise_runs == 'full',
         metric == 'RMSE' | metric == 'NRMSE') %>%
  ggplot(mapping = aes(x = datapoints, y = value,
                       fill = noise)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  facet_wrap(metric ~ entity,
             scales = 'free_y') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90))

plot_errors_long_full_ppp <- errors_long %>%
  filter(summarise_runs == 'full',
         metric == 'ppp' | metric == 'perc') %>%
  ggplot(mapping = aes(x = datapoints, y = value,
                       fill = noise)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  facet_wrap(metric ~ entity,
             scales = 'free_y') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90))

# for the summarised data
plot_errors_long_sum_RMSE <- errors_long %>%
  filter(summarise_runs == 'summarised',
         metric == 'RMSE' | metric == 'NRMSE') %>%
  ggplot(mapping = aes(x = datapoints, y = value,
                       fill = noise)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  facet_wrap(metric ~ entity,
             scales = 'free_y') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90))

plot_errors_long_sum_ppp <- errors_long %>%
  filter(summarise_runs == 'summarised',
         metric == 'ppp' | metric == 'perc') %>%
  ggplot(mapping = aes(x = datapoints, y = value,
                       fill = noise)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  facet_wrap(metric ~ entity,
             scales = 'free_y') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90))
```